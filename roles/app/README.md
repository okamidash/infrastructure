# App

Application specific functions. 

---

```
roles/app
└── freeipa
    ├── dns_zones
    ├── dynamic_dns
    └── letsencrypt
```

### freeipa/letsencrypt

Runs the role `common/acme` to get letsencrypt certificates before installing them to FreeIPA. This role requires manual work.

Roles used: `common/acme`

Vars used:

| Var name               | Purpose                   | Defined where              |
| ---------------------- | ------------------------- | -------------------------- |
| freeipa_admin_password | Password used for FreeIPA | group_vars/all/secrets.yml |

Defaults:

| Var Name                  | Purpose                                                                   | Type   | Default   |
| ------------------------- | ------------------------------------------------------------------------- | ------ | --------- |
| acme_default_user         | User under which acme.sh will be installed for, along with cert location. | string | web       |
| acme_default_user_homedir | Default home dir location for the acme default user                       | string | /home/web |

### freeipa/dns_zones

Creates and deletes DNS zones specified in the `networks` dict.

Assumes that the IPA server is on `ipa.yourdomain.com` 

States: `present`,`absent`.

Vars used:

| Var name               | Purpose                   | Defined where              |
| ---------------------- | ------------------------- | -------------------------- |
| freeipa_admin_password | Password used for FreeIPA | group_vars/all/secrets.yml |

Defaults:

| Var Name                  | Purpose                                             | Type   | Default          |
| ------------------------- | --------------------------------------------------- | ------ | ---------------- |
| freeipa_host              | The host to connect to freeipa with.                | string | ipa.{{ domain }} |
| acme_default_user_homedir | Default home dir location for the acme default user | string | /home/web        |

### freipa/dynamic_dns

Edits named.conf to include the rndc.key generated by the host. This is then copied over into 3 returned variables. Please note that this requires some manual intervention  as you need to add ``grant "rndc-key" zonesub ANY;` into each zone's Options.

States: `present`, `absent`.

Returned vars:

| Var Name       | Purpose                    | Type   |
| -------------- | -------------------------- | ------ |
| rndc_key       | Full Key for Dynamic DNS   | String |
| rndc_secret    | Secret part of Rndc key    | String |
| rndc_algorithm | Algorithm for the Rndc key | String |
